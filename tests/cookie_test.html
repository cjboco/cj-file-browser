<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="expires" content="-1" />
<title>CJ File Browser</title>
</head>
<body>

<form id="tester" name="tester" action="javascript:void(0);" method="post">
<label for="secpath">Base Path (security.xml): </label><input name="secpath" id="secpath" value="/" /><br />
<label for="initpath">Passed Path (init): </label><input name="initpath" id="initpath" value="/Test/" /><br />
<label for="userpath">User Path: </label><select name="userpath" id="userpath"></select><br />
<br />
<label form="debug">Debug:</label><br />
<textarea name="debug" id="debug" rows="10" cols="40"></textarea>
</form>

<div id="CJFileBrowser"></div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<script><!--
(function ($) {
	"use strict";

	var $secpath = $('#secpath'),
		$initpath = $('#initpath'),
		$sel = $('#userpath'),
		$debug = $('#debug'),
		opts = {
			baseRelPath: []
		},
		sys = {};



	function doSelectSetup() {
		var testpaths = [$initpath.val(), 'content/','images/','2012/'],
			temppath = '';
		$sel.html('');
		$.each(testpaths, function(i) {
			temppath += testpaths[i].toLowerCase();
			$sel.append('<option value="' + temppath + '">' + temppath + '</option>');
		});

		console.log($initpath.val());
	}

	$secpath.on('change', function() {
		var $this = $(this),
			v = $this.val().toLowerCase();
		if (v.substring(0,1) !== '/') {
			$this.val('/' + $this.val());
		}
		$this.val(v);
		// make sure the passed path is valid based on security
		if ($initpath.val().indexOf($this.val())) {
			$initpath.val($this.val())
		}
	}).val($secpath.val().toLowerCase());
	$initpath.on('load change', function() {
		var $this = $(this),
			v = $this.val().toLowerCase();
		if (v.substring(0,1) !== '/') {
			$this.val('/' + $this.val());
		}
		$this.val(v);
		doSelectSetup();
	}).val($initpath.val().toLowerCase());
	doSelectSetup();


	// check stuff
	function checkPath() {
		var c = $sel.val(),
			t = '/',
			tempBaseRef = [];
		if (c !== null && typeof c === 'string' && c.length > 1 && c.indexOf($initpath.val()) > -1) {
			opts.baseRelPath = [c]
		} else {
			opts.baseRelPath = [$initpath.val()];
		}
		console.log(opts.baseRelPath);
	}

	$sel.on('change', function() {
		checkPath();
	});


}(jQuery));
//-->
</script>

</body>
</html>